import{b as k,g as u}from"./navigation.59116f01.js";import{p as d}from"./stores.62da9543.js";import{w as g}from"./singletons.ca2c2715.js";import{e as p}from"./utils.9d5f2fc9.js";const b=async()=>{var t,e;if(!Array.isArray((t=history.state)==null?void 0:t.stack)||((e=history.state)==null?void 0:e.stack.length)===0){const o=[c(window.location)];await u(window.location.toString(),{replaceState:!0,state:{...history.state,stack:o}})}},l=g("");d.subscribe(t=>{t!=null&&t.url&&(t.url.search!==""||t.url.hash!==""?l.set(t.url.pathname):l.set(t.url.pathname.replace(/\/[^/]+\/?$/,"")))});const c=t=>`${t.pathname}${t.search}${t.hash}`,P=()=>{b(),k(async t=>{if(t.type==="link"){if(t.to===null||t.to.url.protocol!==window.location.protocol||t.to.url.host!==window.location.host)return;t.cancel(),await m(t.to.url.toString())}})};async function U(){return await m(p(l))}async function m(t,e={}){var f,y;const o=new URL(t,window.location.href);if(o.protocol!==window.location.protocol||o.host!==window.location.host)throw new Error("Navigating away from site, cannot be performed by stackGo.");if(!Array.isArray((f=history.state)==null?void 0:f.stack)||((y=history.state)==null?void 0:y.stack.length)===0)throw new Error("History API not properly configured!");const{stack:r}=history.state,w=c(o);let a=r.findLastIndex(s=>w.startsWith(s));for(;!(a<0||!(new URL(r[a],window.location.href).search!==""));)a--;let i=0,n=!1;a===-1?(i=r.length-1,n=!0):(i=r.length-a-1,r[a]===w?n=!0:i===1&&(i=0,n=!0));const h=async()=>{const s=n?[...r.slice(0,a),c(o)]:[...r.slice(0,a+1),c(o)];await u(t,{...e??{},replaceState:n,state:{...history.state,...(e==null?void 0:e.state)??{},stack:s}})};if(i>0){const s=()=>{window.removeEventListener("popstate",s),h()};window.addEventListener("popstate",s),history.go(-i)}else await h()}export{P as a,U as b,l as c,m as s};
